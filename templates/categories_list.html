{% extends 'base.html' %}

{% block title %}カテゴリー追加・編集 - Kakeibo App{% endblock %}

{% block header %}
    <h1>カテゴリー追加・編集</h1>
{% endblock %}

{% block content %}
    <div class="card mb-4">
        <div class="card-header">新しい小カテゴリを追加</div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('categories') }}">
                <div class="mb-3">
                    <label for="mainCategorySelect" class="form-label">大カテゴリ</label>
                    <select class="form-select" id="mainCategorySelect" name="main_category_id" required>
                        {% for main in main_categories %}
                            <option value="{{ main[0] }}">{{ main[1] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="newSubCategoryName" class="form-label">新しい小カテゴリ名</label>
                    <input type="text" class="form-control" id="newSubCategoryName" name="name" required>
                </div>
                <button type="submit" class="btn btn-primary">追加</button>
            </form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">既存のカテゴリ</div>
        <div class="card-body">
            {% for main in main_categories %}
                <h4>{{ main[1] }}</h4>
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>小カテゴリ名</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sub in sub_categories %}
                            {% if sub[1] == main[0] %}
                            <tr>
                                <td>{{ sub[0] }}</td>
                                <td>{{ sub[2] }}</td>
                                <td>
                                    <a href="{{ url_for('edit_category', sub_category_id=sub[0]) }}" class="btn btn-sm btn-primary">編集</a>
                                    <form action="{{ url_for('delete_category', sub_category_id=sub[0]) }}" method="POST" style="display:inline;" onsubmit="return confirm('本当に削除しますか？このカテゴリに紐づく取引も削除されます。');">
                                        <button type="submit" class="btn btn-sm btn-danger">削除</button>
                                    </form>
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>カテゴリがありません。</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}
