<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Kakeibo App{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block bg-light sidebar vh-100">
                <div class="position-sticky pt-3">
                    <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Kakeibo</span>
                    </h4>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('index') }}">
                                ホーム
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('add') }}">
                                追加
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('edit') }}">
                                編集
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('categories') }}">
                                カテゴリー追加・編集
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('graphs') }}">
                                グラフ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('dev_options') }}">
                                開発者オプション
                            </a>
                        </li>
                    </ul>

                    <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>今月の予算進捗</span>
                    </h4>
                    <ul class="nav flex-column mb-2">
                        <li class="nav-item">
                            <select class="form-select form-select-sm" id="monthSelect">
                                {% for month_option in months %}
                                    <option value="{{ month_option }}" {% if month_option == selected_month %}selected{% endif %}>{{ month_option }}</option>
                                {% endfor %}
                            </select>
                        </li>
                        {% for item in budget_progress %}
                            <li class="nav-item">
                                <span class="d-block px-3 text-muted">{{ item.category }}: {{ item.spent }}円 / {{ item.budget }}円</span>
                                <div class="progress mx-3" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: {{ item.percentage }}%;" aria-valuenow="{{ item.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>

                    <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>贈与見える化</span>
                    </h4>
                    <ul class="nav flex-column mb-2">
                        {% if gift_summary %}
                            {% for item in gift_summary %}
                                <li class="nav-item">
                                    <span class="d-block px-3 text-muted">{{ item.detail }}: {{ item.return_amount }}円 / {{ item.gift_amount }}円</span>
                                    <div class="progress mx-3" style="height: 5px;">
                                        <div class="progress-bar" role="progressbar" style="width: {{ item.percentage }}%;" aria-valuenow="{{ item.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="nav-item"><span class="d-block px-3 text-muted">贈与に関するデータがありません。</span></li>
                        {% endif %}
                    </ul>

                    <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>未入力の月額</span>
                    </h4>
                    <ul class="nav flex-column mb-2">
                        {% if unentered_amounts %}
                            {% for item in unentered_amounts %}
                                <li class="nav-item">
                                    <span class="d-block px-3 text-muted">● {{ item.detail }} (前回入力 {{ item.last_date }})</span>
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="nav-item"><span class="d-block px-3 text-muted">未入力の月額はありません。</span></li>
                        {% endif %}
                    </ul>

                    <hr class="mx-3">
                    <ul class="nav flex-column mb-2">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                ログアウト
                            </a>
                        </li>
                    </ul>
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const monthSelect = document.getElementById('monthSelect');
                            if (monthSelect) {
                                monthSelect.addEventListener('change', function() {
                                    const currentPath = window.location.pathname;
                                    const newUrl = currentPath + '?month=' + this.value;
                                    window.location.href = newUrl;
                                });
                            }
                        });
                    </script>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="pt-3 pb-2 mb-3 border-bottom">
                    {% block header %}{% endblock %}
                </div>
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>